(function(c){var m=window.AmazonUIPageJS||window.P,p=m._namespace||m.attributeErrors,a=p?p("IVMTwisterPriceFetcherAssets",""):m;a.guardFatal?a.guardFatal(c)(a,window):a.execute(function(){c(a,window)})})(function(c,m,p){c.declare("ivm-twister-constants",{VERSION_FOR_COUNTRY_DIMENSION_NAME:"version_for_country",IVM_TWISTER_SELECTION_CHANGED:"ivm:twister:selection_changed",IVM_TWISTER_FETCH_PRICES_REQUESTED:"ivm:twister:fetch_prices_requested",IVM_TWISTER_FETCH_PRICES_SUCCEEDED:"ivm:twister:fetch_prices_succeeded",
IVM_TWISTER_FETCH_PRICES_FAILED:"ivm:twister:fetch_prices_failed",IVM_TWISTER_INVALID_SEL_INFO_VALID_COMBINATIONS_STRING:"ivm:twister:invalid_sel_info_valid_combinations_string",IVM_TWISTER_SWATCH_NOT_FOUND:"ivm:twister:swatch_not_found",IVM_TWISTER_SWATCH_PRICE_INITIALIZE_FAILED:"ivm:twister:swatch_price_initialize_failed",IVM_TWISTER_SWATCH_PRICE_UPDATE_FAILED:"ivm:twister:swatch_price_update_failed",IVM_TWISTER_ATTRIBUTION:"ivm-twister",IVM_TWISTER_VARIATION_CHANGE_EVENT:"VARIATION_CHANGE",IVM_HELPER_LINK_ID:"ivm-explain-modal-link",
IVM_TWISTER_SELECTED_SWATCH_CLASS:"swatchSelect",IVM_TWISTER_SWATCH_PRICE_SPAN_CLASS:"twisterSwatchPrice",IVM_TWISTER_SWATCH_PRICE_WRAPPER_CLASS:"twisterSwatchPriceWrapper",VERSION_FOR_COUNTRY_SWATCH_SELECTOR:"div#variation_version_for_country li",VERSION_FOR_COUNTRY_SWATCH_TEXT_SELECTOR:".twisterTextDiv .a-size-base",IVM_TWISTER_PRICE_SEPARATOR:" - ",IVM_TWISTER_DIM_COMBINATION_SEPARATOR:":"});"use strict";c.when("A","jQuery","ivm-twister-constants").register("ivm-twister-helper",function(a,e,b){return{isIvmFeatureEnabled:function(){var a=
e("#"+b.IVM_HELPER_LINK_ID);return null!==a&&0<a.length}}});"use strict";c.when("A","jQuery","ivm-twister-constants","ivm-twister-helper","ivm-twister-price-updater","ivm-twister-csm-counters").register("ivm-twister-controller",function(a,e,b,v,d,l){a.on(b.IVM_TWISTER_SELECTION_CHANGED,function(e){l.incrementCounter(b.IVM_TWISTER_SELECTION_CHANGED,1);d.clearIvmTwisterPrices();a.trigger(b.IVM_TWISTER_FETCH_PRICES_REQUESTED,e);l.incrementCounter(b.IVM_TWISTER_FETCH_PRICES_REQUESTED,1)});a.on(b.IVM_TWISTER_FETCH_PRICES_FAILED,
function(a){l.incrementCounter(b.IVM_TWISTER_FETCH_PRICES_FAILED,1);c.log("Received "+b.IVM_TWISTER_FETCH_PRICES_FAILED+". Message: "+a+".","ERROR",b.IVM_TWISTER_ATTRIBUTION)});a.on(b.IVM_TWISTER_FETCH_PRICES_SUCCEEDED,function(a){l.incrementCounter(b.IVM_TWISTER_FETCH_PRICES_SUCCEEDED,1);d.showIvmTwisterPrices(a)});return{twisterSelectionChangedHandler:function(d,h,f){if(v.isIvmFeatureEnabled()){var g=f.dimensionInfo;if(!(2>g.length)){var r=!1,t=!1;g.forEach(function(b){b.dimKey===d?r=!0:1<b.size&&
(t=!0)});if(r&&t){h=e.map(h,function(b){return b.dimKey===d?"[^d+$]":b.val});h=new RegExp(h.join(":"),"g");for(var g=f.validCombinatonString,q=[],u;u=h.exec(g);)q.push(u[0]);if(0===q.length)c.log("ivm-twister-controller::twisterSelectionChangedHandler: Found no asinKeys for regexp: "+h+", validCombinatonString: "+g,"ERROR",b.IVM_TWISTER_ATTRIBUTION),l.incrementCounter(b.IVM_TWISTER_INVALID_SEL_INFO_VALID_COMBINATIONS_STRING,1);else{var k=f.dimCombinations;f=e.map(q,function(b){return k[b]});a.trigger(b.IVM_TWISTER_SELECTION_CHANGED,
f)}}}}}}});"use strict";c.when("A").register("ivm-twister-csm-counters",function(a){var e=function(b){return ue.count(b)||0},b=function(b,a){ue.count(b,a)};return{getCounter:e,setCounter:b,incrementCounter:function(a,d){d=d||1;b(a,e(a)+d)}}});c.when("A","jQuery","cf","ivm-twister-price-updater").execute("ivm-twister-initialize-price-slots",function(a,e,b,c){c.initializeIvmPriceSlots()});c.when("A","jQuery","ivm-twister-constants","ivm-twister-controller","desktop-twister").execute("ivm-twister-initial-price-fetch",
function(a,e,b,c,d){c.twisterSelectionChangedHandler(b.VERSION_FOR_COUNTRY_DIMENSION_NAME,d.tsm.currentState().selected().selInfo,d.tvm)});"use strict";c.when("A","jQuery","ivm-twister-constants","ivm-twister-controller","desktop-twister").register("ivm-twister-passive-view-registration",function(a,e,b,c,d){this.initialize=function(){var a={viewAttribution:b.IVM_TWISTER_ATTRIBUTION,viewName:"VersionForCountryAsinsAfterSelectionChanged"};d.registerPassive(a,{updateView:function(a,e){a===b.IVM_TWISTER_VARIATION_CHANGE_EVENT&&
c.twisterSelectionChangedHandler(b.VERSION_FOR_COUNTRY_DIMENSION_NAME,e.selected().selInfo,d.tvm)}});console.log(a," registered.")};this.initialize()});"use strict";c.when("A","jQuery","ivm-twister-constants","desktop-twister").register("ivm-twister-price-fetcher",function(a,e,b,c){function d(c){try{if(!c.ASIN)throw Error("ASIN not set in callback from slotsDimSum");var d;var h=c.Value.content.twisterSlotDiv;if(!h)throw Error("Invalid ASIN slot in callback from slotsDimSum");var f=e(e.parseXML("\x3civmRoot\x3e"+
h+"\x3c/ivmRoot\x3e")).find(".twisterSwatchPrice");d=f.length?a.trim(f.text()):!1;d&&a.trigger(b.IVM_TWISTER_FETCH_PRICES_SUCCEEDED,[{asin:c.ASIN,price:d}])}catch(g){a.trigger(b.IVM_TWISTER_FETCH_PRICES_FAILED,{asins:[c.ASIN],error:g})}}a.on(b.IVM_TWISTER_FETCH_PRICES_REQUESTED,function(e){try{e.length&&c.slotsDimSum.get(e,d)}catch(n){a.trigger(b.IVM_TWISTER_FETCH_PRICES_FAILED,{asins:e,error:n})}})});"use strict";c.when("A","jQuery","ivm-twister-constants","ivm-twister-csm-counters","ivm-twister-helper",
"desktop-twister").register("ivm-twister-price-updater",function(a,e,b,m,d,l){var n=function(a,e){m.incrementCounter(a,1);c.log(e,"ERROR",b.IVM_TWISTER_ATTRIBUTION)},h=function(a,c){var d=e("\x3cspan/\x3e",{class:b.IVM_TWISTER_SWATCH_PRICE_WRAPPER_CLASS,html:b.IVM_TWISTER_PRICE_SEPARATOR});d.append(e("\x3cspan/\x3e",{class:b.IVM_TWISTER_SWATCH_PRICE_SPAN_CLASS,html:c}));a.append(d)},f=function(a,c,d){a.forEach(function(a){a=a.trim().split(b.IVM_TWISTER_DIM_COMBINATION_SEPARATOR)[c];a=e(b.VERSION_FOR_COUNTRY_SWATCH_SELECTOR+
":eq("+a+")").find(b.VERSION_FOR_COUNTRY_SWATCH_TEXT_SELECTOR);if(null===a||0===a.length)return n(b.IVM_TWISTER_SWATCH_NOT_FOUND,"Could not find IVM swatch to clear price with selector '"+b.VERSION_FOR_COUNTRY_SWATCH_SELECTOR+" "+b.VERSION_FOR_COUNTRY_SWATCH_TEXT_SELECTOR+"', for asin: "+d.asin+"."),!1;var g=d.price,k=a.find("."+b.IVM_TWISTER_SWATCH_PRICE_WRAPPER_CLASS);null===k||0===k.length?h(a,g):(0===a.parents("."+b.IVM_TWISTER_SELECTED_SWATCH_CLASS).length&&k.find("."+b.IVM_TWISTER_SWATCH_PRICE_SPAN_CLASS).html(g),
k.show())})};return{initializeIvmPriceSlots:function(){if(d.isIvmFeatureEnabled()){var a=e(b.VERSION_FOR_COUNTRY_SWATCH_SELECTOR+" "+b.VERSION_FOR_COUNTRY_SWATCH_TEXT_SELECTOR);null!==a&&0<a.length&&a.each(function(){var a=e(this);try{var c=a.contents().get(0).nodeValue.trim(),d=/\s-\s[\D]*\d[\d,.]*[\D]*/g,g=c.match(d),k=a.find("."+b.IVM_TWISTER_SWATCH_PRICE_WRAPPER_CLASS);null!==g&&(a.contents().get(0).nodeValue=c.replace(d,""),null!==k&&0!==k.length||h(a,g[0].replace(/^\s-\s/g,"")))}catch(f){n(b.IVM_TWISTER_SWATCH_PRICE_INITIALIZE_FAILED,
"Price initialize failed for: "+a.text().trim()+". Message: "+f.message+". Stack: "+f.stack)}})}},clearIvmTwisterPrices:function(){e(b.VERSION_FOR_COUNTRY_SWATCH_SELECTOR+" "+b.VERSION_FOR_COUNTRY_SWATCH_TEXT_SELECTOR+" ."+b.IVM_TWISTER_SWATCH_PRICE_WRAPPER_CLASS).each(function(){e(this).hide()})},showIvmTwisterPrices:function(a){a.forEach(function(a){try{var c=l.tvm,d=Object.keys(c.dimCombinations).filter(function(b){return c.dimCombinations[b]===a.asin}),e=c.dimInfoMap[b.VERSION_FOR_COUNTRY_DIMENSION_NAME].dimOrder}catch(k){return n(b.IVM_TWISTER_SWATCH_PRICE_UPDATE_FAILED,
"Price update failed for ASIN: "+a.asin+". Message: "+k.message+". Stack: "+k.stack),!1}f(d,e,a)})}}})});